{"componentChunkName":"component---src-templates-post-template-tsx","path":"/articles/2021/gatsby-start","result":{"data":{"markdownRemark":{"html":"<p>对于想要构建个人网站的开发者来说，使用 <a href=\"https://www.gatsbyjs.com/\">Gatsby</a> 是一个比较好的选择。当然还有其他优秀的网站生成工具，可以在这里找到：<a href=\"https://jamstack.org/generators/\">https://jamstack.org/generators/</a>。其中我还尝试过 <a href=\"https://jekyllrb.com/\">Jekyll</a>、<a href=\"https://hexo.io/\">Hexo</a>，他们被称作静态网站生成器（static website generator），通常被用来生成博客（Blog）网站，开发者可以在项目中按 markdown 格式编辑好文章（.md 文件），然后里面的构建工具将这些文件转换成静态网页（.html 文件）。</p>\n<p>我之所以最终选择了 Gatsby，是出于以下几点考虑</p>\n<ol>\n<li>我是一名前端开发工程师，倾向基于 Javascript 的工具</li>\n<li>目前我对 React 使用较多，倾向基于 React 的工具</li>\n<li>Gatsby 里使用了 GraphQL，抱着学习的态度，我想要继续尝试</li>\n<li>Gatsby 有着丰富好用的插件，可以按照自己的需求自由组合，灵活搭建</li>\n</ol>\n<p>目前 Gatsby 的官方文档还没有中文版本，内容虽然丰富，但是我体验下来，感觉组织庞杂，稍显混乱。曾多次试图从文档中寻找解答，都花费了比较多的时间，也可能是因为自己英文阅读功底不够。总之，就决定把使用经验总结一下，方便今后查阅，这是这篇指南的初衷。</p>\n<h2>开始使用</h2>\n<p>可从以下两种方式入手：</p>\n<ul>\n<li>挑选模板生成</li>\n<li>自行按需安装</li>\n</ul>\n<h3>挑选模板生成</h3>\n<p><a href=\"(https://www.gatsbyjs.com/docs/reference/gatsby-cli/)\">Gatsby CLI</a> + <a href=\"https://www.gatsbyjs.com/docs/how-to/local-development/starters/\">Starter</a> 即可搭好项目。步骤如下：</p>\n<ol>\n<li>打开 <a href=\"https://www.gatsbyjs.com/starters/?v=2\">Starter 市场</a> 挑选模板</li>\n<li>安装 CLI：<code class=\"language-text\">npm i -g gatsby-cli</code></li>\n<li>生成项目：<code class=\"language-text\">gatsby new {your-project-name} {link-to-starter}</code></li>\n</ol>\n<p>不妨进入 Starter 市场看看，便能明白。</p>\n<p>推荐几个我喜欢的：</p>\n<h4>1. <a href=\"https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog/\">gatsby-starter-blog</a></h4>\n<p><img src=\"https://www.gatsbyjs.com/static/0e2cc8c09f8ba56fc8577df9c589c431/54967/3576b917c4111516bdfc044ec7465d09.png\" alt=\"gatsby-starter-blog\"></p>\n<h4>2. <a href=\"https://www.gatsbyjs.com/starters/greglobinski/gatsby-starter-personal-blog/\">gatsby-starter-personal-blog</a></h4>\n<p><img src=\"https://www.gatsbyjs.com/static/f711962897bdda482c311b31597b22ff/54967/e8db43d9ac6b90ddb001a918b4b0962e.png\" alt=\"gatsby-starter-personal-blog\"></p>\n<h4>3. <a href=\"https://github.com/junhobaik/junhobaik.github.io\">junhobaik.github.io</a></h4>\n<p>第 3 个是从 github 上找的，如果 Starter 市场上没有找到满意的，可以试着在 github 上搜索一下。</p>\n<p>使用模板生成项目一步到位、相当快捷，但是可能有以下缺陷：</p>\n<ol>\n<li>绝大多数是英文模板，换成中文效果不好</li>\n<li>进一步定制外观，会破坏原有视觉设计</li>\n<li>存在不需要的功能，移除比较费事</li>\n<li>依赖的工具版本过时，升级会碰到阻碍</li>\n</ol>\n<p>如果追求省事儿、快速，并且对定制没有过多要求，推荐采用这种方式</p>\n<h3>自行按需安装</h3>\n<p>因为我对定制要求较高，又期望对用到的工具能够有详细的了解，最终选择这种方式。</p>\n<p>可以从原始的 Starter 开始搭建，也可以从空目录开始。</p>\n<h4>原始 Starter</h4>\n<p>严格来说也是用模板生成的方式，但这里强调项目内容原始，包括很少的依赖，和仅用于提供指导的页面，方便自行定制。推荐两个：</p>\n<ol>\n<li><a href=\"https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-hello-world/\">gatsby-starter-hello-world</a></li>\n<li><a href=\"https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-default/\">gatsby-starter-default</a></li>\n</ol>\n<p>它们预装的依赖如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"gatsby\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.26.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.12.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"react-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.12.0\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"gatsby\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.26.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"gatsby-image\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.5.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"gatsby-plugin-manifest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.6.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"gatsby-plugin-offline\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.4.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"gatsby-plugin-react-helmet\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.4.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"gatsby-plugin-sharp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.8.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"gatsby-source-filesystem\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.5.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"gatsby-transformer-sharp\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^2.6.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"prop-types\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^15.7.2\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.12.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"react-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.12.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"react-helmet\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.1.0\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>空目录开始</h4>\n<p>得到的项目和 gatsby-starter-hello-world 基本一致：</p>\n<ol>\n<li>新建目录，例：<code class=\"language-text\">mkdir blog</code></li>\n<li>生成 package.json ：<code class=\"language-text\">cd blog &amp;&amp; npm init -y</code></li>\n<li>安装依赖 ：<code class=\"language-text\">npm i react react-dom gatsby</code></li>\n</ol>\n<h4>添加页面</h4>\n<p>页面必须放置在 <code class=\"language-text\">src/pages</code> 目录下，通常 <code class=\"language-text\">index.js</code> （首页） 和 <code class=\"language-text\">404.js</code>（404 not found） 是需要的。</p>\n<p>往 package.json 中添加脚本命令</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby develop\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"gatsby build\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>至此，运行 <code class=\"language-text\">npm start</code> 启动即可按提示查看页面效果</p>\n<h3>部署</h3>\n<p>这里讲述如何部署到 <a href=\"https://pages.github.com/\">GitHub Pages</a>。</p>\n<p>参考官方文档提供的指导：<a href=\"https://www.gatsbyjs.com/docs/how-to/previews-deploys-hosting/how-gatsby-works-with-github-pages/\">How Gatsby Works with GitHub Pages</a></p>\n<p>总结整个过程就是：</p>\n<ol>\n<li>前往 github 项目仓库，找到并做好 GitHub Pages 相关配置</li>\n<li>安装 gh-pages 工具，并且添加 deploy 脚本命令到 package.json</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby build --prefix-paths <span class=\"token operator\">&amp;&amp;</span> gh-pages -d public</code></pre></div>\n<p>很轻松，说一下 gh-pages 工具的原理，就是先在本地构建好需要发布的文件，然后 gh-pages 工具按指定目录将文件提交到 gh-pages 分支，再推送到远程 github 仓库上罢了。此外不多赘述。</p>\n<h3>样式</h3>\n<p>Gatsby 文档提供的指导：<a href=\"https://www.gatsbyjs.com/docs/how-to/styling/\">Styling</a></p>\n<p>上面列出了许多方案。考虑到以后想要方便切换主题，这里我选择了使用 <a href=\"https://www.gatsbyjs.com/docs/how-to/styling/theme-ui/\">Theme UI</a></p>\n<p>Theme UI 就是在一个文件中（<code class=\"language-text\">gatsby-plugin-theme-ui</code>）定义好一些样式变量，然后可以在组件文件中使用这些变量。它的官方文档提供了一些指导：<a href=\"https://theme-ui.com/recipes\">Theme UI Recipes</a>，可以参考它们搭建最基本的初始样式。</p>\n<h2>文章页</h2>\n<p>Markdown 语法简介，当今也被广泛地用于编辑文章内容。Gatsby 可以很方便地将 markdown 文章转化成页面，需要用到 <code class=\"language-text\">gatsby-source-filesystem</code> 和 <code class=\"language-text\">gatsby-transformer-remark</code> 页面。前者能够将文件解析成文件对象（ graphql 查询中的 file 节点），后者进一步将 markdown 文件内容转换成 html 内容，并生成特定的 markdown 数据对象（ graphql 查询中的 markdownRemark 节点）。</p>\n<p>对比安装前后的 graphql 查询节点如下：</p>\n<p><img src=\"/assets/query_default.png\" alt=\"query default\"></p>\n<p><img src=\"/assets/query_markdown.png\" alt=\"query markdown\"></p>\n<p>参考文档： <a href=\"https://www.gatsbyjs.com/docs/how-to/routing/adding-markdown-pages/\">Adding Markdown Pages</a></p>\n<p>总结过程含 3 步：</p>\n<ol>\n<li>安装插件，并在 <code class=\"language-text\">gatsby-config.js</code> 中做好配置</li>\n<li>添加文章，定义好文章头（ frontmatter ）</li>\n<li>在 <code class=\"language-text\">gatsby-node.js</code> 文件中定义好文章生成逻辑（ <code class=\"language-text\">createPages</code> 函数）</li>\n</ol>\n<p>可以使用 Hexo 的测试文章来测试效果：<a href=\"https://github.com/hexojs/hexo-theme-unit-test\">https://github.com/hexojs/hexo-theme-unit-test</a></p>\n<h3>PrismJS</h3>\n<p>技术分享类的博客网站，通常会涉及到许多代码内容，使用 <a href=\"http://prismjs.com/\">PrismJS</a> 将会得到非常美观的代码样式： <a href=\"https://www.gatsbyjs.com/plugins/gatsby-remark-prismjs/\">gatsby-remark-prismjs</a></p>\n<p>配置相当简单：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n   resolve<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-remark</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n   options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n     plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-remark-prismjs</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>它能够给代码块内容添加上特定的类名。</p>\n<p>然后在 <code class=\"language-text\">gatsby-node.js</code> 文件中引入想要的样式即可</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token string\">\"prismjs/themes/prism.css\"</span></code></pre></div>\n<h2>结语</h2>\n<p>至此已经具备一个博客网站的雏形，入门所需就介绍到这里，往后可以继续探索更多细节。</p>","frontmatter":{"title":"Gatsby 入门指南","date":"2021年 01月20"}}},"pageContext":{"slug":"/articles/2021/gatsby-start"}},"staticQueryHashes":[]}